name: Homebrew Formula Update

on:
  release:
    # only for newly published releases, not drafts or updates to existing ones
    types: [published]

jobs:
  trigger-homebrew-update:
    name: Trigger Homebrew formula update
    runs-on: ubuntu-latest
    # Only run if the Release workflow succeeded and was triggered by a tag
    if: >
      (github.event_name == 'release' &&
      github.event.release.draft == false &&
      github.event.release.prerelease == false)

    steps:
      - name: Trigger formula update
        uses: peter-evans/repository-dispatch@v4
        with:
          token: ${{ secrets.PAT }}
          repository: pirafrank/homebrew-tap
          event-type: update_formula
          client-payload: '{"project_name": "poof"}'

      - name: Log dispatch
        run: |
          echo "Dispatched Homebrew formula update for tag: ${{ github.event.release.tag_name }}"
